<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Trucking Command Center</title>

<style>
body { font-family: system-ui, sans-serif; margin:0; background:#0b0f17; color:#e7eefc; }
h2 { margin-top:20px }
.card { background:#121a27; padding:14px; border-radius:12px; margin:10px }
input, select, button {
  width:100%; padding:10px; margin:6px 0;
  border-radius:8px; border:none;
}
button { background:#57c4ff; font-weight:bold }
.small { font-size:12px; color:#93a4bf }
.list { background:#172238; padding:10px; border-radius:10px; margin-top:10px }
</style>
</head>

<body>

<div class="card">
<h2>Driver / Company Setup</h2>
<input id="driverName" placeholder="Driver Name"/>
<input id="companyName" placeholder="Company Name"/>
<button onclick="saveProfile()">Save Profile</button>
<div id="profileOut" class="small"></div>
</div>

<div class="card">
<h2>Household Monthly Budget</h2>
<input id="groceries" type="number" placeholder="Groceries"/>
<input id="entertainment" type="number" placeholder="Entertainment"/>
<input id="mortgage" type="number" placeholder="Mortgage / Rent"/>
<input id="carNote" type="number" placeholder="Car Note"/>
<input id="utilities" type="number" placeholder="Utilities"/>
<input id="personal" type="number" placeholder="Personal"/>
<button onclick="calcHousehold()">Calculate Needed Paycheck</button>
<div id="householdOut"></div>
</div>

<div class="card">
<h2>Truck Setup</h2>
<select id="truckNum">
<option value="">Truck Number</option>
<option>Truck 1</option>
<option>Truck 2</option>
<option>Truck 3</option>
</select>

<select id="trailerNum">
<option value="">Trailer Number</option>
<option>Trailer A</option>
<option>Trailer B</option>
</select>

<select id="tireSize">
<option value="">Tire Size</option>
<option>22.5</option>
<option>24.5</option>
</select>
</div>

<div class="card">
<h2>Add Load</h2>

<input id="loadNumber" placeholder="Load / Trip Number (NO DUPLICATES)"/>
<input id="broker" placeholder="Broker Name"/>
<input id="shipper" placeholder="Shipper Pickup Address"/>
<input id="consignee" placeholder="Delivery Address"/>
<input id="totalMiles" type="number" placeholder="Total Miles"/>
<input id="deadhead" type="number" placeholder="Deadhead Miles"/>

<input id="rate" type="number" placeholder="Load Gross Revenue"/>
<input id="fuelCost" type="number" placeholder="Fuel Cost"/>
<input id="fuelGallon" type="number" placeholder="Fuel Gallons"/>
<input id="maintenance" type="number" placeholder="Maintenance"/>
<input id="tireReserve" type="number" placeholder="Tire Reserve"/>
<input id="plateReserve" type="number" placeholder="Plate Reserve"/>
<input id="ifta" type="number" placeholder="IFTA"/>
<input id="tolls" type="number" placeholder="Tolls"/>

<input id="factoring" type="number" placeholder="Factoring %"/>
<input id="taxReserve" type="number" placeholder="Tax Reserve %"/>

<input id="referral" placeholder="Referral Source"/>

<button onclick="addLoad()">Save Load</button>
<div id="loadMsg" class="small"></div>
</div>

<div class="card">
<h2>Search Loads</h2>
<input id="searchBox" placeholder="Search by load, broker, shipper"/>
<button onclick="renderLoads()">Search</button>
</div>

<div class="card">
<h2>All Loads</h2>
<div id="loadList"></div>
</div>

<div class="card">
<h2>Year To Date Summary</h2>
<div id="ytd"></div>
</div>

<script>
let loads = JSON.parse(localStorage.getItem("loads")||"[]");
let profile = JSON.parse(localStorage.getItem("profile")||"{}");

function saveProfile(){
  profile = {
    driver: driverName.value,
    company: companyName.value
  };
  localStorage.setItem("profile", JSON.stringify(profile));
  profileOut.innerText = "Saved: " + profile.driver + " / " + profile.company;
}

function calcHousehold(){
  let total =
    +groceries.value + +entertainment.value + +mortgage.value +
    +carNote.value + +utilities.value + +personal.value;

  householdOut.innerHTML =
    "<b>Total Monthly Household Need:</b> $" + total.toFixed(2);
}

function addLoad(){
  if(loads.find(l => l.loadNumber === loadNumber.value)){
    loadMsg.innerText = "Duplicate Load Number NOT ALLOWED";
    return;
  }

  let gross = +rate.value;
  let factoringFee = gross * (+factoring.value/100);
  let taxHold = gross * (+taxReserve.value/100);

  let expenses =
    +fuelCost.value + +maintenance.value + +tireReserve.value +
    +plateReserve.value + +ifta.value + +tolls.value + factoringFee + taxHold;

  let net = gross - expenses;
  let rpm = gross / (+totalMiles.value || 1);

  let load = {
    id: Date.now(),
    date: new Date().toLocaleDateString(),
    loadNumber: loadNumber.value,
    broker: broker.value,
    shipper: shipper.value,
    consignee: consignee.value,
    miles: +totalMiles.value,
    deadhead: +deadhead.value,
    gross, expenses, net, rpm,
    referral: referral.value
  };

  loads.push(load);
  localStorage.setItem("loads", JSON.stringify(loads));

  loadMsg.innerText = "Load Saved. Net: $" + net.toFixed(2);
  renderLoads();
}

function renderLoads(){
  let q = searchBox.value.toLowerCase();
  let list = loads
    .filter(l =>
      l.loadNumber.toLowerCase().includes(q) ||
      l.broker.toLowerCase().includes(q) ||
      l.shipper.toLowerCase().includes(q)
    )
    .sort((a,b)=> new Date(b.id)-new Date(a.id));

  loadList.innerHTML = list.map(l=>`
    <div class="list">
      <b>${l.loadNumber}</b> | ${l.date}<br/>
      Broker: ${l.broker}<br/>
      Miles: ${l.miles} | Deadhead: ${l.deadhead}<br/>
      Gross: $${l.gross.toFixed(2)}<br/>
      Net: $${l.net.toFixed(2)}<br/>
      RPM: $${l.rpm.toFixed(2)}
    </div>
  `).join("");

  let totalGross = loads.reduce((a,b)=>a+b.gross,0);
  let totalNet = loads.reduce((a,b)=>a+b.net,0);

  ytd.innerHTML = `
    <b>Total Gross:</b> $${totalGross.toFixed(2)}<br/>
    <b>Total Net:</b> $${totalNet.toFixed(2)}<br/>
    <b>Total Loads:</b> ${loads.length}
  `;
}

renderLoads();
</script>

</body>
</html>
